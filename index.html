<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ (–∫–æ–π–æ—Ç —Å—Ç–∏–ª—å)</title>
  <style>
    :root{
      --bg:#d0b89f;
      --card:#c2a98c;
      --accent:#2b241c;
      --border:#3c3326;
      --btn:#3c3326;
      --btn-text:#fff;
    }
    body{font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--accent);display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;padding:24px}
    .app{width:600px;max-width:100%;background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 22px rgba(0,0,0,0.2)}
    h1{margin:0 0 12px;font-size:20px;text-align:center}
    .grid{display:grid;gap:6px;background:transparent;padding:10px;justify-content:center}
    .cell{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border:2px solid var(--border);font-weight:700;font-size:28px;background:#e3d2b3;color:var(--accent);border-radius:6px;min-width:60px}
    .controls{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;justify-content:center;align-items:center}
    button{padding:8px 12px;border-radius:8px;border:0;background:var(--btn);color:var(--btn-text);cursor:pointer;font-weight:600}
    button.secondary{background:#e3d2b3;color:var(--accent);border:1px solid var(--border)}
    select, input[type=range]{padding:6px;border-radius:8px;border:1px solid var(--border);background:#f5ebd5;color:var(--accent);font-weight:600}
    footer{margin-top:12px;font-size:13px;color:var(--accent);text-align:center}
  </style>
</head>
<body>
  <div class="app">
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ (–∫–æ–π–æ—Ç —Å—Ç–∏–ª—å)</h1>
    <div class="controls">
      <label>–†–æ–∑–º—ñ—Ä:
        <select id="sizeSelect">
          <option value="3">3√ó3</option>
          <option value="4">4√ó4</option>
          <option value="5">5√ó5</option>
        </select>
      </label>
    </div>
    <div id="grid" class="grid" aria-label="—Å—ñ—Ç–∫–∞" style="grid-template-columns: repeat(3, 1fr);"><div class="cell">2</div><div class="cell">7</div><div class="cell">6</div><div class="cell">9</div><div class="cell">4</div><div class="cell">8</div><div class="cell">3</div><div class="cell">5</div><div class="cell">1</div></div>

    <div class="controls">
      <button id="shuffleBtn">üîÄ –ü–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç–∏</button>
      <button id="regenBtn" class="secondary">‚ôªÔ∏è –ù–æ–≤–∞ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è</button>
      <button id="downloadBtn" class="secondary">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PNG</button>
    </div>

    <footer>–ö–æ–π–æ—Ç —Å—Ç–∏–ª—å ‚Äî –≤–∏–ø–∞–¥–∫–æ–≤–µ —Ä–æ–∑—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —á–∏—Å–µ–ª —É –∫–≤–∞–¥—Ä–∞—Ç—ñ –∑–∞–¥–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É.</footer>
  </div>

  <canvas id="exportCanvas" width="900" height="900" style="display:none"></canvas>

  <script>
    function shuffleArray(a){
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    const gridEl = document.getElementById('grid');
    const sizeSelect = document.getElementById('sizeSelect');
    let numbers = [];
    let gridSize = 3;

    function generateNumbers(n){
      const total = n*n;
      const arr = [];
      for(let i=1;i<=total;i++) arr.push(i);
      return shuffleArray(arr);
    }

    function makeGrid(nums,n){
      gridEl.innerHTML = '';
      gridEl.style.gridTemplateColumns = `repeat(${n}, 1fr)`;
      for(let i=0;i<nums.length;i++){
        const div = document.createElement('div');
        div.className = 'cell';
        div.textContent = nums[i];
        gridEl.appendChild(div);
      }
    }

    function newPermutation(){
      numbers = generateNumbers(gridSize);
      makeGrid(numbers, gridSize);
    }

    document.getElementById('shuffleBtn').addEventListener('click', ()=>{
      numbers = shuffleArray(numbers.slice());
      makeGrid(numbers, gridSize);
    });

    document.getElementById('regenBtn').addEventListener('click', ()=> newPermutation());

    sizeSelect.addEventListener('change', ()=>{
      gridSize = parseInt(sizeSelect.value);
      newPermutation();
    });

    function downloadPNG(){
      const canvas = document.getElementById('exportCanvas');
      const ctx = canvas.getContext('2d');
      const size = Math.min(canvas.width, canvas.height);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#e3d2b3';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      const margin = 40;
      const gridPix = size - margin*2;
      const cell = gridPix / gridSize;

      ctx.lineWidth = 6;
      ctx.strokeStyle = '#3c3326';
      ctx.font = Math.floor(cell*0.45) + 'px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#2b241c';

      for(let r=0;r<gridSize;r++){
        for(let c=0;c<gridSize;c++){
          const x = margin + c*cell;
          const y = margin + r*cell;
          ctx.strokeRect(x, y, cell, cell);
          const val = numbers[r*gridSize + c];
          ctx.fillText(String(val), x + cell/2, y + cell/2);
        }
      }

      const dataUrl = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = `square_${gridSize}x${gridSize}.png`;
      a.click();
    }

    document.getElementById('downloadBtn').addEventListener('click', downloadPNG);

    newPermutation();
  </script>
</body>
</html>
